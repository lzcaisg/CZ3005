% =========== 1. Initiate Data =========== %
rank(michael_phelps, 1).
rank(larisa_latynina, 2).
rank(marit_bjorgen, 3).
rank(nikolai_andrianov, 4).
rank(ole_einar_bjorndalen, 5).
rank(boris_shakhlin, 6).
rank(edoardo_mangiarotti, 7).
rank(takashi_ono, 8).
rank(paavo_nurmi, 9).
rank(birgit_fischer, 10).
rank(bjorn_daehlie, 11).
rank(sawao_kato, 12).
rank(jenny_thompson, 13).
rank(ryan_lochte, 14).
rank(dara_torres, 15).
rank(alexei_nemov, 16).
rank(natalie_coughlin, 17).
rank(mark_spitz, 18).
rank(matt_biondi, 19).
rank(vera_caslavska, 20).
nation(michael_phelps, united_states).
nation(larisa_latynina, soviet_union).
nation(marit_bjorgen, norway).
nation(nikolai_andrianov, soviet_union).
nation(ole_einar_bjorndalen, norway).
nation(boris_shakhlin, soviet_union).
nation(edoardo_mangiarotti, italy).
nation(takashi_ono, japan).
nation(paavo_nurmi, finland).
nation(birgit_fischer, germany).
nation(bjorn_daehlie, norway).
nation(sawao_kato, japan).
nation(jenny_thompson, united_states).
nation(ryan_lochte, united_states).
nation(dara_torres, united_states).
nation(alexei_nemov, russia).
nation(natalie_coughlin, united_states).
nation(mark_spitz, united_states).
nation(matt_biondi, united_states).
nation(vera_caslavska, czechoslovakia).
sport(michael_phelps, swimming).
sport(larisa_latynina, gymnastics).
sport(marit_bjorgen, cross_country_skiing).
sport(nikolai_andrianov, gymnastics).
sport(ole_einar_bjorndalen, biathlon).
sport(boris_shakhlin, gymnastics).
sport(edoardo_mangiarotti, fencing).
sport(takashi_ono, gymnastics).
sport(paavo_nurmi, athletics).
sport(birgit_fischer, canoeing).
sport(bjorn_daehlie, cross_country_skiing).
sport(sawao_kato, gymnastics).
sport(jenny_thompson, swimming).
sport(ryan_lochte, swimming).
sport(dara_torres, swimming).
sport(alexei_nemov, gymnastics).
sport(natalie_coughlin, swimming).
sport(mark_spitz, swimming).
sport(matt_biondi, swimming).
sport(vera_caslavska, gymnastics).
start_year(michael_phelps, 2004).
start_year(larisa_latynina, 1956).
start_year(marit_bjorgen, 2002).
start_year(nikolai_andrianov, 1972).
start_year(ole_einar_bjorndalen, 1998).
start_year(boris_shakhlin, 1956).
start_year(edoardo_mangiarotti, 1936).
start_year(takashi_ono, 1952).
start_year(paavo_nurmi, 1920).
start_year(birgit_fischer, 1980).
start_year(bjorn_daehlie, 1992).
start_year(sawao_kato, 1968).
start_year(jenny_thompson, 1992).
start_year(ryan_lochte, 2004).
start_year(dara_torres, 1984).
start_year(alexei_nemov, 1996).
start_year(natalie_coughlin, 2004).
start_year(mark_spitz, 1968).
start_year(matt_biondi, 1984).
start_year(vera_caslavska, 1960).
end_year(michael_phelps, 2016).
end_year(larisa_latynina, 1964).
end_year(marit_bjorgen, 2018).
end_year(nikolai_andrianov, 1980).
end_year(ole_einar_bjorndalen, 2014).
end_year(boris_shakhlin, 1964).
end_year(edoardo_mangiarotti, 1960).
end_year(takashi_ono, 1964).
end_year(paavo_nurmi, 1928).
end_year(birgit_fischer, 2004).
end_year(bjorn_daehlie, 1998).
end_year(sawao_kato, 1976).
end_year(jenny_thompson, 2004).
end_year(ryan_lochte, 2016).
end_year(dara_torres, 2008).
end_year(alexei_nemov, 2000).
end_year(natalie_coughlin, 2012).
end_year(mark_spitz, 1972).
end_year(matt_biondi, 1992).
end_year(vera_caslavska, 1968).
season(michael_phelps, summer).
season(larisa_latynina, summer).
season(marit_bjorgen, winter).
season(nikolai_andrianov, summer).
season(ole_einar_bjorndalen, winter).
season(boris_shakhlin, summer).
season(edoardo_mangiarotti, summer).
season(takashi_ono, summer).
season(paavo_nurmi, summer).
season(birgit_fischer, summer).
season(bjorn_daehlie, winter).
season(sawao_kato, summer).
season(jenny_thompson, summer).
season(ryan_lochte, summer).
season(dara_torres, summer).
season(alexei_nemov, summer).
season(natalie_coughlin, summer).
season(mark_spitz, summer).
season(matt_biondi, summer).
season(vera_caslavska, summer).
gender(michael_phelps, m).
gender(larisa_latynina, f).
gender(marit_bjorgen, f).
gender(nikolai_andrianov, m).
gender(ole_einar_bjorndalen, m).
gender(boris_shakhlin, m).
gender(edoardo_mangiarotti, m).
gender(takashi_ono, m).
gender(paavo_nurmi, m).
gender(birgit_fischer, f).
gender(bjorn_daehlie, m).
gender(sawao_kato, m).
gender(jenny_thompson, f).
gender(ryan_lochte, m).
gender(dara_torres, f).
gender(alexei_nemov, m).
gender(natalie_coughlin, f).
gender(mark_spitz, m).
gender(matt_biondi, m).
gender(vera_caslavska, f).
gold_no(michael_phelps, 23).
gold_no(larisa_latynina, 9).
gold_no(marit_bjorgen, 8).
gold_no(nikolai_andrianov, 7).
gold_no(ole_einar_bjorndalen, 8).
gold_no(boris_shakhlin, 7).
gold_no(edoardo_mangiarotti, 6).
gold_no(takashi_ono, 5).
gold_no(paavo_nurmi, 9).
gold_no(birgit_fischer, 8).
gold_no(bjorn_daehlie, 8).
gold_no(sawao_kato, 8).
gold_no(jenny_thompson, 8).
gold_no(ryan_lochte, 6).
gold_no(dara_torres, 4).
gold_no(alexei_nemov, 4).
gold_no(natalie_coughlin, 3).
gold_no(mark_spitz, 9).
gold_no(matt_biondi, 8).
gold_no(vera_caslavska, 7).
silver_no(michael_phelps, 3).
silver_no(larisa_latynina, 5).
silver_no(marit_bjorgen, 4).
silver_no(nikolai_andrianov, 5).
silver_no(ole_einar_bjorndalen, 4).
silver_no(boris_shakhlin, 4).
silver_no(edoardo_mangiarotti, 5).
silver_no(takashi_ono, 4).
silver_no(paavo_nurmi, 3).
silver_no(birgit_fischer, 4).
silver_no(bjorn_daehlie, 4).
silver_no(sawao_kato, 3).
silver_no(jenny_thompson, 3).
silver_no(ryan_lochte, 3).
silver_no(dara_torres, 4).
silver_no(alexei_nemov, 2).
silver_no(natalie_coughlin, 4).
silver_no(mark_spitz, 1).
silver_no(matt_biondi, 2).
silver_no(vera_caslavska, 4).
bronze_no(michael_phelps, 2).
bronze_no(larisa_latynina, 4).
bronze_no(marit_bjorgen, 3).
bronze_no(nikolai_andrianov, 3).
bronze_no(ole_einar_bjorndalen, 1).
bronze_no(boris_shakhlin, 2).
bronze_no(edoardo_mangiarotti, 2).
bronze_no(takashi_ono, 4).
bronze_no(paavo_nurmi, 0).
bronze_no(birgit_fischer, 0).
bronze_no(bjorn_daehlie, 0).
bronze_no(sawao_kato, 1).
bronze_no(jenny_thompson, 1).
bronze_no(ryan_lochte, 3).
bronze_no(dara_torres, 4).
bronze_no(alexei_nemov, 6).
bronze_no(natalie_coughlin, 5).
bronze_no(mark_spitz, 1).
bronze_no(matt_biondi, 1).
bronze_no(vera_caslavska, 0).
total_no(michael_phelps, 28).
total_no(larisa_latynina, 18).
total_no(marit_bjorgen, 15).
total_no(nikolai_andrianov, 15).
total_no(ole_einar_bjorndalen, 13).
total_no(boris_shakhlin, 13).
total_no(edoardo_mangiarotti, 13).
total_no(takashi_ono, 13).
total_no(paavo_nurmi, 12).
total_no(birgit_fischer, 12).
total_no(bjorn_daehlie, 12).
total_no(sawao_kato, 12).
total_no(jenny_thompson, 12).
total_no(ryan_lochte, 12).
total_no(dara_torres, 12).
total_no(alexei_nemov, 12).
total_no(natalie_coughlin, 12).
total_no(mark_spitz, 11).
total_no(matt_biondi, 11).
total_no(vera_caslavska, 11).

% =========== 2. Declare Dynamic Procedure =========== %
% is(Athlete): the program will decide the athlete.
% count(int): the total count of queries uesd.
:- dynamic is/1.
:- dynamic count/1.

is(nobody).
nameList([michael_phelps, larisa_latynina, marit_bjorgen, nikolai_andrianov, ole_einar_bjorndalen, boris_shakhlin, edoardo_mangiarotti, takashi_ono, paavo_nurmi, birgit_fischer, bjorn_daehlie, sawao_kato, jenny_thompson, ryan_lochte, dara_torres, alexei_nemov, natalie_coughlin, mark_spitz, matt_biondi, vera_caslavska]).

% =========== 3. Set Counter ===========  %
lowestCount(X) :-
    count(X),             % X will be the smallest, if...
    \+ (count(Y), Y < X). % ... there does not exist another Y that is smaller than X.

checkZero(X) :-
    (   X =< -1, % If the 10 chances has been used up.
        write("The Question Count has Reached."),nl,
        is(Athlete),
        write("The Answer is: "),
        write(Athlete),
        fail);
    (   X=1, % Else: if there is 1 last chance remaining: Set Reminder
        write("One Last Chance."));
     X>=0.

updateCount :-
    assert(count(10)),
    lowestCount(X), % Search for the lowest count so far
    integer(X),
    X1 is X-1,
    checkZero(X1), % Check whether the next count reaches 0: If so returns false.
    assert(count(X1)), % Update the latest count.
    write("You have "),
    write(X1),
    write(" chances remaining").

choose(List, Elt) :-
    length(List, Length),
    random(0, Length, Index),
    nth0(Index, List, Elt).

% =========== 4. Set the Starter and Query Procedure ===========  %
start :-
    retractall(is(X)),
    retractall(count(X)), % Clean up the Memory
    assert(count(10)), % Reset the Counter 
    nameList(TheNameList),
    choose(TheNameList, Athlete), % Randomly pick an athlete
    assert(is(Athlete)), % Record the Athlete into the buffer

    write("******************************"),nl,
    write("We will start the ten question game. Please refer to the website below and try to guess one athlete among the TOP 20."),nl,nl,
    write("https://en.wikipedia.org/wiki/List_of_multiple_Olympic_medalists"),nl,nl,

    write("You can query from the following fields using [userCheck(Item, Value)]:"), nl,nl,
    write("- rank: The athlete's world ranking regarding his/her total medal number."), nl,
    write("- nation: The nation of the athlete."), nl,
    write("- sport: The sport that the athlete played."),nl,
    write("- start_year: The first year that this athlete participated in the Olympic Game."), nl,
    write("- end_year: The last year that this athlete participated in the Olympic Game."), nl,
    write("- active_year: The year in which the athlete was active."), nl,
    write("- season: The type of Olympic (summer/winter)."), nl,
    write("- gender: The gender of the athlete (m/f)."), nl,
    write("- gold_no: The number of gold medal."), nl,
    write("- silver_no: The number of silver medal."), nl,
    write("- bronze_no: The number of bronze medal."), nl,
    write("- total_no: The total number of medal."), nl,nl,
    write("You may start guessing now. All the best."),nl,
    write("******************************").

userCheck(Item, Value):-
    updateCount,
    check(Item, Value).

%=========== 5. Define all the atomic check logic =========== %

check(rank, Rank):-
    is(Athlete),
    rank(Athlete, Rank).

check(nation, Nation):-
    is(Athlete),
    nation(Athlete, Nation).

check(sport, Sport):-
    is(Athlete),
    sport(Athlete, Sport).

check(start_year, Start_Year):-
    is(Athlete),
    start_year(Athlete, Start_Year).

check(end_year, End_Year):-
    is(Athlete),
    end_year(Athlete, End_Year).

% ========== Learned from online resources ========== %
between(Lo,Hi,N) :-
  integer(Lo),
  integer(Hi),
  between_sub(Lo,Hi,N).

between_sub(Lo,Hi,Lo) :- % unify the lower bound with the result
  Lo =< Hi.            % - if we haven't yet exceeded the inclusive upper bound.

between_sub(Lo,Hi,N)  :- % otherwise...
  Lo < Hi ,           % - if the lower bound is less than the inclusive upper bound
  L1 is Lo+1 ,        % - increment the lower bound
  between_sub(L1,Hi,N).   % - and recurse down.

% =================================================== %
check(active_year, Active_Year):-
    is(Athlete),
    start_year(Athlete, Start_Year),
    end_year(Athlete, End_Year),
    between(Start_Year, End_Year, Active_Year).

check(season, Season):-
    is(Athlete),
    season(Athlete, Season).

check(gender, Gender):-
    is(Athlete),
    gender(Athlete, Gender).

check(gold_no, Gold_No):-
    is(Athlete),
    gold_no(Athlete, Gold_No).

check(silver_no, Silver_No):-
    is(Athlete),
    silver_no(Athlete, Silver_No).

check(bronze_no, Bronze_No):-
    is(Athlete),
    bronze_no(Athlete, Bronze_No).

check(total_no, Total_No):-
    is(Athlete),
    total_no(Athlete, Total_No).

